<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Editor de Imagens</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="fundo-editor">
    <div class="page">
        <h1>üñºÔ∏è Editor de Filtros</h1>

        {% if erro %}
            <div class="message error">{{ erro }}</div>
        {% endif %}

        <form method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <label for="imagem">Escolha uma imagem:</label>
                <input type="file" name="imagem" id="imagem" accept="image/*" required>
            </div>

            <div class="form-group">
                <label for="filtro">Escolha um filtro:</label>
                <select name="filtro" id="filtro">
                    {% for f in filtros %}
                        <option value="{{ f }}">{{ f.replace('_', ' ')|capitalize }}</option>
                    {% endfor %}
                </select>
            </div>

            <button type="submit">Aplicar Filtro</button>
        </form>

        <!-- √Årea de pr√©-visualiza√ß√£o (adicionada) -->
        <div class="image-container">
            <h3>Pr√©-visualiza√ß√£o:</h3>
            <img id="preview" src="" alt="Pr√©-visualiza√ß√£o" style="display: none;">
        </div>

        {% if imagem_processada %}
        <div class="image-container">
            <h3>Resultado Final:</h3>
            <img src="data:image/png;base64,{{ imagem_processada }}" alt="Imagem filtrada">
            <a href="data:image/png;base64,{{ imagem_processada }}" download="imagem_filtrada.png">üì• Baixar imagem</a>
        </div>
        {% endif %}
    </div>

    <!-- JavaScript para pr√©-visualiza√ß√£o em tempo real -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const input = document.querySelector('#imagem');
            const select = document.querySelector('#filtro');
            const preview = document.querySelector('#preview');

            input.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                        applyFilter(); // Aplica o filtro inicial
                    };
                    reader.readAsDataURL(file);
                }
            });

            select.addEventListener('change', applyFilter);

            function applyFilter() {
                const filtro = select.value;
                let cssFilter = '';

                switch (filtro) {
                    case 'preto_branco':
                        cssFilter = 'grayscale(100%)';
                        break;
                    case 'sepia':
                        cssFilter = 'sepia(100%)';
                        break;
                    case 'inverter':
                        cssFilter = 'invert(100%)';
                        break;
                    case 'blur':
                        cssFilter = 'blur(3px)';
                        break;
                    case 'contorno':
                        // Aproxima√ß√£o: alto contraste + grayscale + invert
                        cssFilter = 'contrast(1000%) brightness(0%) invert(100%)';
                        break;
                    case 'bordas':
                        // Aproxima√ß√£o: alto contraste para real√ßar bordas
                        cssFilter = 'contrast(200%)';
                        break;
                    case 'detalhe':
                        // Aproxima√ß√£o: leve aumento de contraste
                        cssFilter = 'contrast(120%)';
                        break;
                    case 'realce':
                        cssFilter = 'contrast(150%)';
                        break;
                    case 'saturacao_alta':
                        cssFilter = 'saturate(150%)';
                        break;
                    case 'saturacao_baixa':
                        cssFilter = 'saturate(50%)';
                        break;
                    case 'nitidez':
                        // Aproxima√ß√£o: contraste + brilho leve (CSS n√£o tem sharpen exato)
                        cssFilter = 'contrast(110%) brightness(105%)';
                        break;
                    case 'escurecer':
                        cssFilter = 'brightness(70%)';
                        break;
                    case 'clarear':
                        cssFilter = 'brightness(130%)';
                        break;
                    default:
                        cssFilter = 'none';
                }

                preview.style.filter = cssFilter;
            }
        });
    </script>
</body>
    </html>
